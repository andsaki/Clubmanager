<% today = Date.today%>
<% @events = Event.where("group_id = ?", current_user.state_group_id) %>

  <table align="center">
    <caption>
      <h2>
      <%= "#{today.strftime('%Y年%-m月')}"%>
    </h2>
    </caption>

    <tr>
      <th width="30" height="20"><font color="red">日</font></th>
      <th width="30" height="20">月</th>
      <th width="30" height="20">火</th>
      <th width="30" height="20">水</th>
      <th width="30" height="20">木</th>
      <th width="30" height="20">金</th>
      <th width="30" height="20"><font color="blue">土</font></th>
    </tr>


    <% month = today.strftime('%m')%>
      <% d = today.at_beginning_of_month.at_beginning_of_week(:sunday)%>
        <% 1.upto(6).each do |i| %>
          <tr>
            <% (d..d.end_of_week(:sunday)).each do |c| %>
          <th width = "20" height = "20">
          <font size = "1">
    	  <% @f = 0 %>
          <% if c.strftime('%m') == month then %>
            <% @events.each do |e| %>
	      <% if ( (c.strftime('%Y') == e.year) && (c.strftime('%m') == e.month) && (c.strftime('%d') == e.date) ) then %>

                <% if c.strftime("%-d") == today.strftime("%-d") %>
                  <font color="red">▶︎</font>
                <% else %>
                <% end %>
                <%= link_to "#{c.strftime('%-d')}", events_neoindex_path(:year => c.strftime('%Y'), :month => c.strftime("%-m"), :day => c.strftime("%-d")) %>
		<% @f = 1 %>
                <% break %>
                <% else %>
                <% end %>
                <% end %>
                <% if @f == 0 then %>

                  <% if c.strftime("%-d") == today.strftime("%-d") %>
		    <font color="red">▶︎</font>
                  <% else %>
                  <% end %>

	          <%= c.strftime("%-d") %>

                  <% else %>
                  <% end %>
		  <% else %>
		  <% end %>
              </font>
            </th>
            <% end %>
          <% d = d + 1.week %>
          </tr>
        <% end %>
  </table>

<!-- 退会処理 -->

<% @tmp = Group.where("id = ?", current_user.state_group_id).first %>
<% if @tmp != nil && @tmp.master_id == current_user.id then %>
<% else %>
<% if current_user.state_group_id != -1 then %>
<%= link_to "退会", "/members/retire", data:{confirm: '本当に退会しますか?'}%>
<% else %>
<% end %>
<% end %>

<!-- /退会処理 -->
